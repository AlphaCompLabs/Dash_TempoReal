<div class="flex flex-col gap-1 w-full h-full">

  <!-- Cabeçalho -->
  <div class="mainchart-header flex items-center justify-between">
    <div class="flex items-center gap-2 ml-4">
      <div class="flex flex-col">
        <h2 class="font-sans text-xl font-bold text-white leading-tight">Tráfego de</h2>
        <span class="font-saved text-3xl font-light text-accent-light leading-tight">REDES</span>
      </div>
      <img src="/assets/images/logo_network_traffic.png" 
           alt="Ícone do Tráfego de Redes" 
           class="h-12 object-contain">
    </div>
    <div class="mainchart-filter flex flex-col items-start gap-1 rounded-lg p-3 dotted-bg">
      <span class="font-sans text-sm text-white">Filtros:</span>
      <div class="flex gap-2">
        <button class="bg-chart-blue-dark text-white px-4 py-1 rounded-md text-sm hover:opacity-80 transition-opacity">Download</button>
        <button class="bg-chart-blue-light text-white px-4 py-1 rounded-md text-sm hover:opacity-80 transition-opacity">Upload</button>
      </div>
    </div>
  </div>

  <!-- Conteúdo principal -->
  <section class="bg-dark p-6 rounded-lg flex flex-col gap-4 w-full flex-grow relative" style="height: 500px;">

    @if (hasClients) {
      <!-- Indicador ao vivo -->
      <div id="live-indicator" class="absolute top-4 right-4 flex h-5 w-5">
        <span class="ping-element animate-ping absolute inline-flex h-full w-full rounded-full bg-red-500 opacity-75"></span>
        <span class="relative inline-flex rounded-full h-5 w-5 bg-red-600"></span>
      </div>

      <!-- Gráfico -->
      <div class="bg-white/5 rounded-lg p-2 w-full h-full flex"> <div class="flex-grow flex gap-2"> <div class="flex flex-col">
        <div class="relative flex-grow w-8 pr-2">
          @for (label of yAxisLabels; track $index) {
            <span class="absolute block right-2 text-xs text-secondary text-right"
                  [style.bottom.%]="(label / maxChartValue) * 100"
                  [style.transform]="'translateY(50%)'">
              {{ label }}
            </span>
          }
        </div>
        <div class="h-8"></div>
      </div>

      <div class="w-full flex flex-col">
        <div class="relative w-full flex-grow border-l-2 border-b-2 border-white/50">
          <div class="grid-lines absolute inset-0">
            @for (label of yAxisLabels; track $index) {
              <div class="absolute left-0 w-full h-px bg-white/10"
                  [style.bottom.%]="(label / maxChartValue) * 100"></div>
              <div class="absolute left-0 h-px w-2 bg-white/30 -translate-x-full"
                  [style.bottom.%]="(label / maxChartValue) * 100"></div>
            }
          </div>

          <div class="w-full h-full flex gap-x-6 px-2">
            @for (client of networkClients; track client.ip) {
              <div class="grow w-0 flex flex-col justify-end">
                <div class="w-full mx-auto flex flex-col rounded-t-md overflow-hidden hover:opacity-80 transition-opacity cursor-pointer"
                    [style.height.%]="calculateTotalHeight(client)">
                  <div class="bg-chart-blue-dark" [style.height.%]="calculateDownloadRatio(client)"></div>
                  <div class="bg-chart-blue-light" [style.height.%]="calculateUploadRatio(client)"></div>
                </div>
              </div>
            }
          </div>
        </div>

        <div class="h-8 w-full flex gap-x-4 px-2 pt-1">
          @for (client of networkClients; track client.ip) {
            <div class="grow w-0 text-center">
              <span class="block text-white text-xs truncate">{{ client.ip }}</span>
              <span class="block text-white/50 text-[10px]">{{ client.name }}</span>
            </div>
          }
        </div>
      </div>

    </div>
  </div>

      <!-- Legenda -->
      <div class="mainchart-footer mt-2">
        <div class="bg-white/5 p-3 rounded-lg flex items-center justify-between gap-4">
          <div class="flex flex-col items-start gap-1">
            <span class="font-sans font-bold text-sm text-accent-light">Descrição:</span>
            <div class="flex items-center justify-left gap-6 text-xs text-white">
              <div class="flex items-center gap-2">
                <span class="w-3 h-3 rounded-full bg-chart-blue-dark"></span> Download
              </div>
              <div class="flex items-center gap-2">
                <span class="w-3 h-3 rounded-full bg-chart-blue-light"></span> Upload
              </div>
            </div>
          </div>
          <p class="text-secondary text-xs text-right max-w-xs">
            *Para acessar mais informações sobre um Cliente (IP), clique na sua barra correspondente do gráfico.
          </p>
        </div>
      </div>

    } @else {
      <!-- Caso sem clientes -->
      <div class="flex items-center justify-center h-full">
        <p class="text-white text-lg text-center">
          Não há Clientes (IP) conectados a esse servidor no momento.
        </p>
      </div>
    }

  </section>
</div>
